# –°–∏—Å—Ç–µ–º–∞ –≥–ª—É–±–æ–∫–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

–ì–ª—É–±–æ–∫–∏–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥), –∞ –ø–æ–∏—Å–∫ –Ω–∞–∏–ª—É—á—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤), —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø–µ—Ä–∏–æ–¥—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, —É—Ä–æ–≤–Ω–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤, —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π, —Å –ø–æ–º–æ—â—å—é –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∏—Å–∫–∞, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø—Ä–∏–±—ã–ª—å–Ω–æ–π –≤ –ø—Ä–æ—à–ª–æ–º –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–∏–±—ã–ª—å–Ω–æ–π –≤ –±—É–¥—É—â–µ–º

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backtesting/
‚îú‚îÄ‚îÄ strategy_base.py       # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚îú‚îÄ‚îÄ backtest_engine.py     # –î–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ optimizer.py           # –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ strategies.py          # –ì–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îú‚îÄ‚îÄ example_usage.py       # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
- –°–∏–º—É–ª—è—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –£—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤ –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º –∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–¥–µ–ª–∫–∞–º

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **Grid Search** - –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
- **Random Search** - —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–∏—Å–∫ (–±—ã—Å—Ç—Ä–µ–µ Grid Search)
- **Walk-Forward Analysis** - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å)

### –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑
- –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫: –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, Sharpe Ratio, Sortino Ratio, Profit Factor
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (drawdown)
- –í–∏–Ω—Ä–µ–π—Ç, —Å—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫
- –ö—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞ (equity curve)

### –ì–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- SMA Crossover (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö)
- RSI Strategy (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ RSI)
- Bollinger Bands Strategy
- MACD Strategy

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- SMA, EMA (—Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ)
- RSI (–∏–Ω–¥–µ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–ª—ã)
- Bollinger Bands (–ø–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞)
- MACD (—Å—Ö–æ–∂–¥–µ–Ω–∏–µ/—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö)
- ATR (—Å—Ä–µ–¥–Ω–∏–π –∏—Å—Ç–∏–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω)
- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: crossover, crossunder

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install polars numpy
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:
```
data/tickers/AFKS/1H.parquet
data/tickers/AFKS/1D.parquet
# –∏ —Ç.–¥.
```

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏:
```bash
python scripts/data/download_archives.py AFKS
python scripts/data/process_archives.py AFKS
```

### 3. –ü—Ä–æ—Å—Ç–æ–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥

```python
from backtest_engine import Backtest, load_data
from strategies import SMACrossoverStrategy

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
data = load_data('AFKS', '1H')

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
params = {
    'fast_period': 10,
    'slow_period': 30,
    'stop_loss_pct': 0.02,
    'take_profit_pct': 0.05
}

# –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
backtest = Backtest(
    data=data,
    strategy_class=SMACrossoverStrategy,
    strategy_params=params,
    initial_capital=100000.0,
    commission=0.001  # 0.1%
)

result = backtest.run()
result.print_summary()
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```python
from optimizer import Optimizer

# –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
param_space = {
    'fast_period': [5, 10, 15, 20],
    'slow_period': [20, 30, 50, 100],
    'stop_loss_pct': [0.01, 0.02, 0.03],
    'take_profit_pct': [0.03, 0.05, 0.10]
}

# –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
optimizer = Optimizer(
    data=data,
    strategy_class=SMACrossoverStrategy,
    param_space=param_space,
    optimization_metric='sharpe_ratio',
    n_jobs=4  # 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞
)

# –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
best_result = optimizer.grid_search()
```

## –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```python
from strategy_base import Strategy, Signal

class MyStrategy(Strategy):
    """–í–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è."""
    
    def init(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤."""
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        self.indicators['sma'] = self.sma(period=20)
        self.indicators['rsi'] = self.rsi(period=14)
    
    def next(self) -> Signal:
        """–õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞."""
        i = self.current_bar
        
        # –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
        price = self.close[i]
        sma = self.indicators['sma'][i]
        rsi = self.indicators['rsi'][i]
        
        # –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
        if price > sma and rsi < 30:
            return Signal(
                'BUY',
                price,
                self.date[i],
                stop_loss=price * 0.98,
                take_profit=price * 1.05
            )
        
        # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
        if self.has_position() and rsi > 70:
            return Signal('SELL', price, self.date[i])
        
        return Signal('HOLD', 0, self.date[i])
    
    @classmethod
    def get_param_space(cls):
        """–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏."""
        return {
            'sma_period': [10, 20, 30],
            'rsi_period': [7, 14, 21],
            'rsi_oversold': [20, 30, 40],
            'rsi_overbought': [60, 70, 80]
        }
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

```python
# –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ
sma = self.sma(period=20)
ema = self.ema(period=20)

# RSI
rsi = self.rsi(period=14)

# Bollinger Bands
upper, middle, lower = self.bbands(period=20, std_dev=2.0)

# MACD
macd, signal, histogram = self.macd(fast=12, slow=26, signal=9)

# ATR
atr = self.atr(period=14)

# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
is_crossover = self.crossover(fast_ma, slow_ma)
is_crossunder = self.crossunder(fast_ma, slow_ma)
```

### –ú–µ—Ç–æ–¥—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. Grid Search (–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä)

```python
# –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –í–°–ï –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
optimizer = Optimizer(data, MyStrategy, param_space, n_jobs=4)
best = optimizer.grid_search()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞–π–¥—ë—Ç –æ–ø—Ç–∏–º—É–º
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ú–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –í—Ä–µ–º—è —Ä–∞—Å—Ç—ë—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ù–µ–±–æ–ª—å—à–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (< 1000 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
- –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

#### 2. Random Search (—Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–∏—Å–∫)

```python
# –¢–µ—Å—Ç–∏—Ä—É–µ—Ç N —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
optimizer = Optimizer(data, MyStrategy, param_space)
best = optimizer.random_search(n_iterations=100)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–µ–µ Grid Search
- –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ç–∏–º—É–º
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞—Ä—å–∏—Ä—É—é—Ç—Å—è –æ—Ç –∑–∞–ø—É—Å–∫–∞ –∫ –∑–∞–ø—É—Å–∫—É

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ë–æ–ª—å—à–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (> 1000 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

#### 3. Walk-Forward Analysis (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑)

```python
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–µ
wfa_results = optimizer.walk_forward_analysis(
    train_size=252,  # 1 –≥–æ–¥ –æ–±—É—á–µ–Ω–∏—è
    test_size=63,    # 3 –º–µ—Å—è—Ü–∞ —Ç–µ—Å—Ç
    step_size=21     # –°–¥–≤–∏–≥ –Ω–∞ 1 –º–µ—Å—è—Ü
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ò–∑–±–µ–≥–∞–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è (overfitting)
- –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥
- –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å—á—ë—Ç–µ

### –ú–µ—Ç—Ä–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç—Ä–∏–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö —Ü–µ–ª–µ–π:

```python
# –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
optimization_metric='total_return_percent'

# –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è risk-adjusted return
optimization_metric='sharpe_ratio'      # –ö–ª–∞—Å—Å–∏–∫–∞
optimization_metric='sortino_ratio'     # –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ downside risk

# –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
optimization_metric='profit_factor'     # –û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–µ–π –∫ —É–±—ã—Ç–∫–∞–º
optimization_metric='win_rate'          # –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

# –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–∞–¥–∫–∏
optimization_metric='max_drawdown'      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è)

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞
optimization_metric='risk_adjusted_return'  # Return / Drawdown
```

## –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```python
result = backtest.run()

# –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
print(f"–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {result.total_return_percent:.2f}%")
print(f"–ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞: {result.max_drawdown_percent:.2f}%")
print(f"Profit Factor: {result.profit_factor:.2f}")

# –ú–µ—Ç—Ä–∏–∫–∏ —Å–¥–µ–ª–æ–∫
print(f"–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: {result.total_trades}")
print(f"–í–∏–Ω—Ä–µ–π—Ç: {result.win_rate*100:.1f}%")
print(f"–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: {result.avg_win:.2f}")
print(f"–°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: {result.avg_loss:.2f}")

# Risk-adjusted –º–µ—Ç—Ä–∏–∫–∏
print(f"Sharpe Ratio: {result.sharpe_ratio:.2f}")
print(f"Sortino Ratio: {result.sortino_ratio:.2f}")
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–¥–µ–ª–æ–∫

```python
# –í—Å–µ —Å–¥–µ–ª–∫–∏
for trade in result.trades:
    print(f"{trade.entry_time} ‚Üí {trade.exit_time}")
    print(f"  P&L: {trade.pnl:.2f} ({trade.pnl_percent:.1f}%)")
    print(f"  –ü—Ä–∏—á–∏–Ω–∞: {trade.exit_reason}")
    print(f"  –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {trade.duration:.1f} –¥–Ω–µ–π")

# –¢–æ–ª—å–∫–æ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ
winning_trades = [t for t in result.trades if t.is_winning]
print(f"–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫: {len(winning_trades)}")

# –¢–æ–ª—å–∫–æ —É–±—ã—Ç–æ—á–Ω—ã–µ
losing_trades = [t for t in result.trades if not t.is_winning]
print(f"–£–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫: {len(losing_trades)}")
```

### –ö—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞

```python
# –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞
for date, equity in result.equity_curve:
    print(f"{date}: {equity:.2f}")

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è matplotlib)
import matplotlib.pyplot as plt

dates = [d for d, _ in result.equity_curve]
equity = [e for _, e in result.equity_curve]

plt.figure(figsize=(12, 6))
plt.plot(dates, equity)
plt.title('Equity Curve')
plt.xlabel('Date')
plt.ylabel('Equity')
plt.grid(True)
plt.show()
```

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

### –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ —è–¥—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
import multiprocessing

optimizer = Optimizer(
    data, MyStrategy, param_space,
    n_jobs=multiprocessing.cpu_count()
)
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
optimizer.save_results('optimization_results.json')

# –ó–∞–≥—Ä—É–∑–∫–∞
import json
with open('optimization_results.json') as f:
    results = json.load(f)
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```python
# 3D –≥—Ä–∞—Ñ–∏–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
optimizer.plot_optimization_surface(
    param_x='fast_period',
    param_y='slow_period'
)
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ train/test

```python
# –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
train_data = data[:int(len(data)*0.7)]  # 70% –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ
test_data = data[int(len(data)*0.7):]   # 30% –Ω–∞ —Ç–µ—Å—Ç

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ train
optimizer = Optimizer(train_data, MyStrategy, param_space)
best = optimizer.grid_search()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ test
test_backtest = Backtest(test_data, MyStrategy, best.params)
test_result = test_backtest.run()

print(f"Train return: {best.backtest_result.total_return_percent:.2f}%")
print(f"Test return: {test_result.total_return_percent:.2f}%")
```

## –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### –ò–∑–±–µ–≥–∞–π—Ç–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è (overfitting)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –ø—Ä–æ–≤–∞–ª–∏–≤–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ.

**–†–µ—à–µ–Ω–∏—è:**
1. **Walk-Forward Analysis** - —Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π –º–µ—Ç–æ–¥
2. **Train/Test Split** - —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –∏ —Ç–µ—Å—Ç
3. **Out-of-Sample Testing** - —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–µ–Ω—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ = –º–µ–Ω—å—à–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

### –û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π

**–ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ:**
- –ù–∞ –º–∞–ª–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö (< 100 —Å–¥–µ–ª–æ–∫)
- –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (> 5)
- –¢–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ

**–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:**
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
- –°—Ç–∞–±–∏–ª—å–Ω–∞ –ª–∏ –º–µ—Ç—Ä–∏–∫–∞ –º–µ–∂–¥—É —Ñ–æ–ª–¥–∞–º–∏ WFA

### –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```python
# –ü–†–ê–í–ò–õ–¨–ù–û
backtest = Backtest(
    commission=0.001,   # 0.1% - —Ä–µ–∞–ª—å–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è
    slippage=0.0005     # 0.05% - –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
)

# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
backtest = Backtest(
    commission=0.0,     # –ù—É–ª–µ–≤–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞!
    slippage=0.0
)
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SMA —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```bash
python example_usage.py
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

```python
strategies = [
    SMACrossoverStrategy,
    RSIStrategy,
    BollingerBandsStrategy,
    MACDStrategy
]

for strategy_class in strategies:
    backtest = Backtest(data, strategy_class, default_params)
    result = backtest.run()
    print(f"{strategy_class.__name__}: {result.total_return_percent:.2f}%")
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

```python
timeframes = ['5M', '15M', '30M', '1H', '4H', '1D']

for tf in timeframes:
    data = load_data('AFKS', tf)
    backtest = Backtest(data, MyStrategy, params)
    result = backtest.run()
    print(f"{tf}: Sharpe={result.sharpe_ratio:.2f}")
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞
- "Algorithmic Trading" - Ernest P. Chan
- "Quantitative Trading" - Ernest P. Chan
- "Evidence-Based Technical Analysis" - David Aronson

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [Quantopian Lectures](https://www.quantopian.com/lectures)
- [QuantStart](https://www.quantstart.com/)
- [Backtrader Documentation](https://www.backtrader.com/)

## –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–∏–Ω–≥

–ß—Ç–æ –±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–ª–∏ —É–ª—É—á—à–∏—Ç—å –∫–æ–¥, –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ `strategies.py` —Å–ª–µ–¥—É—è —à–∞–±–ª–æ–Ω—É!

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –∫–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π.  
–¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä—ã–Ω–∫–∞—Ö —Å–æ–ø—Ä—è–∂–µ–Ω–∞ —Å —Ä–∏—Å–∫–æ–º –ø–æ—Ç–µ—Ä–∏ –∫–∞–ø–∏—Ç–∞–ª–∞.

---

**–£–¥–∞—á–∏ –≤ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–µ!**
