## **1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (OHLCV)**



**–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–µ—Ä–∞ [`INSTRUMENTS`](../../settings.py) IMOEX:**

* Date
* Open
* High
* Low
* Close
* Volume
---



## **2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–æ—Å–Ω–æ–≤–∞ –º–æ–¥–µ–ª–∏)**

–ß—Ç–æ–±—ã –º–æ–¥–µ–ª—å –¥–∞–≤–∞–ª–∞ —Å–∏–≥–Ω–∞–ª—ã, –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö —Ñ–∏—á:
### üîπ –¢—Ä–µ–Ω–¥–æ–≤—ã–µ
* SMA(5), SMA(10), SMA(20), SMA(50)
* EMA(10), EMA(20), EMA(50)
* MACD, MACD_signal, MACD_hist
### üîπ –û—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã

* RSI(14)
* Stochastic (%K, %D)
* CCI
* Williams %R

### üîπ –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

* ATR(14)
* Bollinger Bands (upper, middle, lower)
* Price-to-BB (–ø–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª–æ—Å)

### üîπ –û–±—ä—ë–º–Ω—ã–µ

* Volume ROC
* Volume SMA ratio

### üîπ –°–≤–µ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

* Doji
* Hammer
* Engulfing

–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É `ta`:

```python
import ta

df["rsi"] = ta.momentum.RSIIndicator(df["Close"]).rsi()
df["macd"] = ta.trend.MACD(df["Close"]).macd()
df["ema20"] = ta.trend.EMAIndicator(df["Close"], 20).ema_indicator()
df["atr"] = ta.volatility.AverageTrueRange(df["High"], df["Low"], df["Close"]).average_true_range()

```

---

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ data/ti—Åkers

```
data/
    tickers/
        GAZP/
            M1.parquet
            M5.parquet
            M15.parquet
            H1.parquet
            H4.parquet
            ...
        SBER/
            M1.parquet
            ...
```

# –¢–∞–π–º—Ñ—Ä–µ–º—ã

CANDLE_INTERVAL_1_MIN, CANDLE_INTERVAL_5_MIN, CANDLE_INTERVAL_15_MIN, CANDLE_INTERVAL_HOUR, CANDLE_INTERVAL_DAY, CANDLE_INTERVAL_2_MIN, CANDLE_INTERVAL_3_MIN, CANDLE_INTERVAL_10_MIN, CANDLE_INTERVAL_30_MIN, CANDLE_INTERVAL_2_HOUR, CANDLE_INTERVAL_4_HOUR, CANDLE_INTERVAL_WEEK, CANDLE_INTERVAL_MONTH,





# –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–≤–µ—á–µ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ, –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞.

- CANDLE_INTERVAL_1_MIN: –û—Ç 1 –º–∏–Ω—É—Ç—ã –¥–æ 1 –¥–Ω—è. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 2400.
- CANDLE_INTERVAL_5_MIN: –û—Ç 5 –º–∏–Ω—É—Ç –¥–æ –Ω–µ–¥–µ–ª–∏. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 2400.
- CANDLE_INTERVAL_15_MIN: –û—Ç 15 –º–∏–Ω—É—Ç –¥–æ 3 –Ω–µ–¥–µ–ª—å. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 2400.
- CANDLE_INTERVAL_HOUR: –û—Ç 1 —á–∞—Å–∞ –¥–æ 3 –º–µ—Å—è—Ü–µ–≤. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 2400.
- CANDLE_INTERVAL_DAY: –û—Ç 1 –¥–Ω—è –¥–æ 6 –ª–µ—Ç. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 2400.
- CANDLE_INTERVAL_2_MIN: –û—Ç 2 –º–∏–Ω—É—Ç –¥–æ 1 –¥–Ω—è. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 1200.
- CANDLE_INTERVAL_3_MIN: –û—Ç 3 –º–∏–Ω—É—Ç –¥–æ 1 –¥–Ω—è. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 750.
- CANDLE_INTERVAL_10_MIN: –û—Ç 10 –º–∏–Ω—É—Ç –¥–æ –Ω–µ–¥–µ–ª–∏. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 1200.
- CANDLE_INTERVAL_30_MIN: –û—Ç 30 –º–∏–Ω—É—Ç –¥–æ 3 –Ω–µ–¥–µ–ª—å. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 1200.
- CANDLE_INTERVAL_2_HOUR: –û—Ç 2 —á–∞—Å–æ–≤ –¥–æ 3 –º–µ—Å—è—Ü–µ–≤. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 2400.
- CANDLE_INTERVAL_4_HOUR: –û—Ç 4 —á–∞—Å–æ–≤ –¥–æ 3 –º–µ—Å—è—Ü–µ–≤. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 700.
- CANDLE_INTERVAL_WEEK: –û—Ç 1 –Ω–µ–¥–µ–ª–∏ –¥–æ 5 –ª–µ—Ç. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 300.
- CANDLE_INTERVAL_MONTH: –û—Ç 1 –º–µ—Å—è—Ü–∞ –¥–æ 10 –ª–µ—Ç. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ limit ‚Äî 120.

# –ß—Ç–æ –≤ –∏—Ç–æ–≥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ Parquet:

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- time, open, high, low, close, volume

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (–∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 2 –∏ —Å–∫—Ä–∏–ø—Ç–∞ `scripts/data_collector.py`):
- –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ: sma5, sma10, sma20, sma50, ema10, ema20, ema50, ema200
- –¢—Ä–µ–Ω–¥/–º–æ–º–µ–Ω—Ç—É–º: macd, macd_signal, macd_hist, rsi14 (rsi), stoch_k, stoch_d, cci, willr, adx
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: atr, atr_sma50, bb_lower, bb_middle, bb_upper, bb_pband (–ø–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—ã –≤ –ø–æ–ª–æ—Å–∞—Ö)
- –û–±—ä—ë–º—ã: vol_roc, vol_sma20, vol_rel
- –°–≤–µ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã: pat_doji, pat_hammer, pat_engulfing (1 ‚Äî –±—ã—á–∏–π, -1 ‚Äî –º–µ–¥–≤–µ–∂–∏–π, 0 ‚Äî –Ω–µ—Ç)
- –†–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞: regime_vol, regime_trend, regime_liq, market_regime

...


# –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ **–∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç 80% –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏**.
–î–∞–≤–∞–π –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º:

---

# üéØ **1. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç ‚Äú–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Äù –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ OHLCV?**

–ö–æ–≥–¥–∞ –º—ã –≥–æ–≤–æ—Ä–∏–º ‚Äú–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Äù, —ç—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤:

---

# üìå **A. –£–¥–∞–ª–µ–Ω–∏–µ –∏–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**

–£ MOEX –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç:

### ‚úî –ø—Ä–æ–ø—É—Å–∫–∏ (NaN)

‚Äì –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–æ—Ä–≥–æ–≤ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–Ω–∏
‚Äì —Å–±–æ–∏ API

### ‚úî dupe-—Å—Ç—Ä–æ–∫–∏ (–¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ timestamp)

–ù–∞–¥–æ —É–¥–∞–ª–∏—Ç—å.

### ‚úî –Ω–µ–≤–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã (0 –∏–ª–∏ 1 –∫–æ–ø–µ–π–∫–∞)

–ù–∞–ø—Ä–∏–º–µ—Ä:

```

close = 0

```
–∏–ª–∏

```
volume = 0 –≤ —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —Ç–∏–∫–µ—Ä–µ

```

### ‚úî spikes (–∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –≤—ã–±—Ä–æ—Å—ã)

–ù–∞–ø—Ä–∏–º–µ—Ä:

```
–¶–µ–Ω–∞ –ø—Ä—ã–≥–Ω—É–ª–∞ —Å 300 –¥–æ 5000 –∏ –≤–µ—Ä–Ω—É–ª–∞—Å—å –Ω–∞ 300

```

–≠—Ç–æ **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–±–æ–π**, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞.

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª–∞:

```
–µ—Å–ª–∏ |close(i) ‚Äì close(i-1)| > X * ATR ‚Äî —É–¥–∞–ª–∏—Ç—å

```

---
# üìå **B. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–≤–µ—á–µ–π**
–ù–æ —ç—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞.
–ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∏–∂–µ.
---

# üìå **C. –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ —Ä–æ–≤–Ω–æ–π —Å–µ—Ç–∫–µ –≤—Ä–µ–º–µ–Ω–∏**

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è LSTM:

* M1 ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–∫–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞**, –±–µ–∑ –¥—ã—Ä
* M5 ‚Üí –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
* M15 ‚Üí –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
–ï—Å–ª–∏ —Å–≤–µ—á–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –º–æ–∂–Ω–æ:

* –ª–∏–±–æ –≤—Å—Ç–∞–≤–∏—Ç—å –µ—ë —Å **–ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ü–µ–Ω–æ–π** –∏ volume = 0

* –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¢–§)



---



# üìå **D. –û—á–∏—Å—Ç–∫–∞ –æ–±—ä—ë–º–æ–≤**



–ï—Å–ª–∏ volume —Å–∫–∞—á–µ—Ç –Ω–µ—Ä–µ–∞–ª—å–Ω–æ ‚Äî —Ç–æ–∂–µ —É–¥–∞–ª—è–µ–º.



---



# üìå **E. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π**



MOEX –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã —Ç–æ—Ä–≥–æ–≤–ª–∏:



* 07:00‚Äî10:00 ‚Äî —Ä–µ–∂–∏–º—ã –æ—Ç–∫—Ä—ã—Ç–∏—è/–∞—É–∫—Ü–∏–æ–Ω—ã

* 10:00‚Äî18:50 ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º

* 19:00‚Äî23:50 ‚Äî –≤–µ—á–µ—Ä–Ω—è—è —Å–µ—Å—Å–∏—è

* –≤—ã—Ö–æ–¥–Ω—ã–µ ‚Äî –Ω–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (T+1 —Å–¥–µ–ª–∫–∏, –≤–Ω–µ–±–∏—Ä–∂–µ–≤—ã–µ)



–î–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —Ç–æ—Ä–≥–∏**, –∞ –Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ.



---



# ‚ÄºÔ∏è –¢–µ–ø–µ—Ä—å —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å:



# üü¶ **–ù—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª—è—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏?**



### ‚úî **–î–ê, —É–¥–∞–ª—è—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**



–ü—Ä–∏—á–∏–Ω–∞:



### 1) –≠—Ç–æ –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–µ —Ç–æ—Ä–≥–∏



–ù–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –Ω–∞ MOEX **—Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞ –Ω–µ—Ç**, –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ:



* –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å

* –í–Ω–µ–±–∏—Ä–∂–µ–≤—ã–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ) —Å–¥–µ–ª–∫–∏

* –ù–µ—Ç –æ–±—ä–µ–º–æ–≤

* –ù–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏



### 2) –≠—Ç–∏ –¥–Ω–∏ –ª–æ–º–∞—é—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã



–ù–∞–ø—Ä–∏–º–µ—Ä:



* RSI –±—É–¥–µ—Ç –∏—Å–∫–∞–∂—ë–Ω

* ATR —Å—Ç–∞–Ω–µ—Ç –º–∞–ª–µ–Ω—å–∫–∏–º

* Volume-based —Ñ–∏—á–∏ –±—É–¥—É—Ç ‚Äú–≤—Ä–∞—Ç—å‚Äù

* EMA/MA –±—É–¥—É—Ç —Å–≥–ª–∞–∂–∏–≤–∞—Ç—å—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ



### 3) –û–Ω–∏ –ª–æ–º–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä—ã–Ω–∫–∞



–ú–æ–¥–µ–ª—å –Ω–∞—á–Ω—ë—Ç –¥—É–º–∞—Ç—å, —á—Ç–æ:



```

—Ä—ã–Ω–æ–∫ –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å 48 —á–∞—Å–æ–≤ –±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è

```



—á—Ç–æ –ù–ï —è–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –¥–ª—è intraday –º–æ–¥–µ–ª–µ–π.



### 4) –í intraday –º–æ–¥–µ–ª–∏ –≤—ã—Ö–æ–¥–Ω—ã–µ ‚Äî 100% –º—É—Å–æ—Ä



–ï—Å–ª–∏ –º–æ–¥–µ–ª—å —Ç–æ—Ä–≥—É–µ—Ç M15‚ÄìH4:



* –≤—ã—Ö–æ–¥–Ω—ã–µ –±—É–¥—É—Ç –¥–∞–≤–∞—Ç—å **–ª–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã**

* –≥—Ä–∞–Ω–∏—Ü—ã —Å–≤–µ—á–µ–π –±—É–¥—É—Ç ‚Äú–ø–ª–æ—Å–∫–∏–µ‚Äù

* –ø–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞—Ä—É—à–∞—Ç—Å—è



–í—ã—Ö–æ–¥–Ω—ã–µ ‚Äî —ç—Ç–æ –∫–∞–∫ ‚Äú—Å–±–æ–π‚Äù, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è –∫–æ—Ä–º–∏—Ç—å –º–æ–¥–µ–ª–∏.



---



# ‚úî –ò—Ç–æ–≥: —Å–ª–µ–¥—É–µ—Ç —É–¥–∞–ª–∏—Ç—å –í–°–ï —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ:



```

volume == 0

–∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –≤ {—Å—É–±–±–æ—Ç–∞, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ}

–∏ —Ä—ã–Ω–æ–∫ –∑–∞–∫—Ä—ã—Ç

```



---



# üéØ **–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–∏—Å—Ç–∏—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ**



## –ü—Ä–∞–≤–∏–ª–æ:



* –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–Ω–∏, –∫–æ–≥–¥–∞ –±–∏—Ä–∂–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ —Ç–æ—Ä–≥–æ–≤–∞–ª–∞ (–Ω–µ—Ä–∞–±–æ—á–∏–µ –¥–Ω–∏)

* –≠—Ç–æ **–Ω–µ —Ç–æ–ª—å–∫–æ –≤—ã—Ö–æ–¥–Ω—ã–µ**, –Ω–æ –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ (1 —è–Ω–≤–∞—Ä—è, 23 —Ñ–µ–≤—Ä–∞–ª—è, 8 –º–∞—Ä—Ç–∞ –∏ –¥—Ä.)



### –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –¥–Ω–∏:



1. –°–ø–∏—Å–æ–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π MOEX:

   –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `trading_calendar` –∏–∑ MOEX ISS API

   –∏–ª–∏

2. –£–¥–∞–ª—è—Ç—å –≤—Å–µ –¥–∞—Ç—ã, –≥–¥–µ:



```

volume == 0

–∏ open == high == low == close

```



---



# üìò **–ì–æ—Ç–æ–≤—ã–π –∫–æ–¥ –æ—á–∏—Å—Ç–∫–∏**



```python

df = df[df["volume"] > 0]      # —É–¥–∞–ª—è–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ/–ø—Ä–∞–∑–¥–Ω–∏–∫–∏

df = df[df["open"] != df["close"]]  # –µ—â—ë –æ–¥–∏–Ω —Ñ–∏–ª—å—Ç—Ä

df = df[~df.index.weekday.isin([5, 6])]  # —Å—É–±–±–æ—Ç–∞/–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ



# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

df = df.drop_duplicates(subset=["timestamp"])

```

---

# üéØ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (checklist)

| –ü—Ä–æ–±–ª–µ–º–∞                 | –ö–∞–∫ —Ä–µ—à–∞—Ç—å                                         |
| ------------------------ | -------------------------------------------------- |
| –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ/–≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ | —É–¥–∞–ª—è—Ç—å                                            |
| Volume = 0               | —É–¥–∞–ª—è—Ç—å                                            |
| –¶–µ–Ω–∞ = 0                 | —É–¥–∞–ª—è—Ç—å                                            |
| –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ —Å–∫–∞—á–∫–∏        | —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å                                        |
| –î—É–±–ª–∏–∫–∞—Ç—ã                | —É–¥–∞–ª—è—Ç—å                                            |
| –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–≤–µ—á–∏        | –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø—É—Å—Ç—ã–µ —Å–≤–µ—á–∏ –∏–ª–∏ —É–¥–∞–ª—è—Ç—å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¢–§) |
| –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏        | —É–¥–∞–ª—è—Ç—å                                            |

---

# **–ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞**



### ‚úî –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ

### ‚úî –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏–∫–∏

### ‚úî –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—á–µ—Ä–Ω–∏–µ ‚Äú—Ç–æ–Ω–∫–∏–µ‚Äù —Ä–µ–∂–∏–º—ã –µ—Å–ª–∏ —Ç–æ—Ä–≥—É–µ—à—å —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—É—é —Å–µ—Å—Å–∏—é

### ‚úî –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º —Ä–æ–≤–Ω—ã–π

### ‚úî –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏



---





–¢—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—à—ë–ª, –Ω–æ **—Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø—Ä–∏–≤—ë–ª, ‚Äî —Å–ª–∏—à–∫–æ–º —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π**.

–î–ª—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (–æ—Å–æ–±–µ–Ω–Ω–æ LSTM) –Ω—É–∂–Ω—ã **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ, —á–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**, –∞ –Ω–µ ‚Äú–±—ã—á–∏–π/–º–µ–¥–≤–µ–∂–∏–π‚Äù –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–º —Å–º—ã—Å–ª–µ.



–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º, —á—Ç–æ —Ç–∞–∫–æ–µ **regime-based training** –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö quant-—Ñ–∏—Ä–º–∞—Ö, –ö–ê–ö –≤—ã–≥–ª—è–¥—è—Ç –¥–∞–Ω–Ω—ã–µ, –∏ –ö–£–î–ê —ç—Ç–æ –¥–æ–±–∞–≤–ª—è—Ç—å.



---



# üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ ‚Äú—Ä–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞‚Äù (market regimes) –≤ ML-–º–æ–¥–µ–ª—è—Ö



–≠—Ç–æ **—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞**, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–µ, –∫–∞–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è —Ü–µ–Ω–∞, –æ–±—ä—ë–º—ã, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –≤ –ø–µ—Ä–∏–æ–¥.



### –ü—Ä–∏–º–µ—Ä:



‚Äî —Å–ø–æ–∫–æ–π–Ω—ã–π —Ä—ã–Ω–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –æ–¥–Ω–∏–º –∑–∞–∫–æ–Ω–∞–º,

‚Äî –∫—Ä–∏–∑–∏—Å –ø–æ –¥—Ä—É–≥–∏–º,

‚Äî –ø–µ—Ä–∏–æ–¥—ã –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –ª–æ–º–∞—é—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã,

‚Äî ‚Äú—Ç–æ–Ω–∫–∏–µ —Ä—ã–Ω–∫–∏‚Äù (–Ω–∏–∑–∫–∏–µ –æ–±—ä—ë–º—ã) –¥–∞—é—Ç –ª–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã.



**–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç –æ–± —ç—Ç–æ–º ‚Üí –æ–Ω–∞ –¥–µ–ª–∞–µ—Ç –æ—à–∏–±–∫–∏.**



---



# ‚úî –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ regime = –ß–ò–°–õ–û (0,1,2,3...)





---



# –ö–∞–∫–∏–µ —Ä–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–æ–Ω–¥—ã?



–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã—á–∏—Å–ª—è—é—Ç —Ä–µ–∂–∏–º.



---



# üü¶ **1. –†–µ–∂–∏–º—ã –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (—Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ)**



–°—á–∏—Ç–∞–µ–º –¥–Ω–µ–≤–Ω—É—é –∏–ª–∏ —á–∞—Å–æ–≤—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR, std, Parkinson volatility):



* `regime_vol = 0` ‚Üí –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

* `regime_vol = 1` ‚Üí —Å—Ä–µ–¥–Ω—è—è

* `regime_vol = 2` ‚Üí –≤—ã—Å–æ–∫–∞—è

* `regime_vol = 3` ‚Üí —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è (–∫—Ä–∏–∑–∏—Å)



–≠—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å.



---



# üü© **2. –†–µ–∂–∏–º—ã —Ç—Ä–µ–Ω–¥–∞**



–û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —É–≥–ª—É –Ω–∞–∫–ª–æ–Ω–∞ EMA, –∏–ª–∏ MACD, –∏–ª–∏ ADX:



* `regime_trend = 0` ‚Üí —Ñ–ª—ç—Ç

* `regime_trend = 1` ‚Üí –ª—ë–≥–∫–∏–π —Ç—Ä–µ–Ω–¥

* `regime_trend = 2` ‚Üí —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥

* `regime_trend = 3` ‚Üí —Å—É–ø–µ—Ä-—Ç—Ä–µ–Ω–¥ (—Ç—Ä–µ–Ω–¥ –Ω–∞ —Ñ–æ–Ω–µ –ø–∞–Ω–∏–∫–∏/—ç–π—Ñ–æ—Ä–∏–∏)



---



# üüß **3. –†–µ–∂–∏–º—ã –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–≤–∞–∂–Ω–æ –¥–ª—è –†–æ—Å—Å–∏–∏)**



–°–º–æ—Ç—Ä–∏–º –Ω–∞ –æ–±—ä—ë–º—ã:



* `regime_liq = 0` ‚Üí –Ω–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å

* `regime_liq = 1` ‚Üí –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å

* `regime_liq = 2` ‚Üí –∞–Ω–æ–º–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å



–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ 24.02.2022 –æ–±—ä—ë–º—ã —Ä–µ–∑–∫–æ –ø–∞–¥–∞–ª–∏ ‚Üí —ç—Ç–æ –¥—Ä—É–≥–æ–π —Ä–µ–∂–∏–º.



---



# üü® **4. –†–µ–∂–∏–º—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏**



–°—á–∏—Ç–∞–µ–º Rolling-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –∞–∫—Ü–∏–∏ —Å –∏–Ω–¥–µ–∫—Å–æ–º IMOEX:



* `regime_corr = 0` ‚Üí –Ω–∏–∑–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è

* `regime_corr = 1` ‚Üí –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è

* `regime_corr = 2` ‚Üí –≤—ã—Å–æ–∫–∞—è (–¥–≤–∏–∂–µ–Ω–∏–µ —Ä—ã–Ω–∫–æ–º)



---



# üî• –°–∞–º–æ–µ –ª—É—á—à–µ–µ: –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ä–µ–∂–∏–º—ã –≤ –æ–¥–∏–Ω —á–∏—Å–ª–æ–≤–æ–π –∫–ª–∞—Å—Å



```

regime = (

    regime_vol * 10 +

    regime_liq * 3 +

    regime_trend

)

```



–∏–ª–∏ –ø—Ä–æ—â–µ:



```

regime = kmeans.predict([vol, trend, volume])

```



---



# üìå –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤



–§–∞–π–ª `GAZP.parquet`:

| timestamp        | open  | high | low   | close | volume | rsi14 | ema20 | vol_regime | trend_regime | liq_regime | regime |
| ---------------- | ----- | ---- | ----- | ----- | ------ | ----- | ----- | ---------- | ------------ | ---------- | ------ |
| 2024-01-01 10:15 | 150   | 151  | 149   | 150.5 | 200000 | 55    | 149   | 1          | 0            | 1          | 10     |
| 2024-01-01 10:30 | 150.6 | 152  | 150   | 151.9 | 350000 | 62    | 150   | 1          | 2            | 1          | 12     |
| 2024-01-01 10:45 | 152   | 153  | 151.2 | 152.8 | 650000 | 70    | 151   | 2          | 2            | 2          | 22     |

---



# üìå –ö—É–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–µ–∂–∏–º—ã?



**–ü—Ä—è–º–æ –≤ —Ç–∞–±–ª–∏—Ü—É –∫–∞–∫ –µ—â—ë –æ–¥–∏–Ω –Ω–∞–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.**



–¢–≤–æ—è LSTM –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥:



### Input features:



* OHLCV

* —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

* —Ä–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞



### Target:



* BUY / SELL / HOLD (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)



---



# üéØ –ö–∞–∫ —Ä–µ–∂–∏–º—ã –ø–æ–º–æ–≥–∞—é—Ç –º–æ–¥–µ–ª–∏?



–í–æ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:



### ‚ñ™ –í —Å–ø–æ–∫–æ–π–Ω–æ–º —Ä—ã–Ω–∫–µ (2018‚Äì2019):



‚Äî EMA –∏ RSI –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç.



### ‚ñ™ –í –∫—Ä–∏–∑–∏—Å–Ω–æ–º —Ä—ã–Ω–∫–µ (2020 COVID):



‚Äî RSI ‚Äú–ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω‚Äù

‚Äî —Ç—Ä–µ–Ω–¥—ã –∏–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ

‚Äî –º–ª–∞–¥—à–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≤–∞–∂–Ω–µ–µ

‚Äî —Ñ–∞–ª—å—à–∏–≤—ã–µ —Ä–∞–∑–≤–æ—Ä–æ—Ç—ã —á–∞—â–µ



### ‚ñ™ –í –≥–µ–æ–ø–æ–ª–∏—Ç–∏–∫–µ 2022‚Äì2025:



‚Äî –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –º–µ–Ω—è–µ—Ç—Å—è

‚Äî –∫–æ—Ä–∏–¥–æ—Ä—ã —Å–¥–≤–∏–≥–∞—é—Ç—Å—è

‚Äî –ø–æ—è–≤–ª—è—é—Ç—Å—è –≥—ç–ø—ã

‚Äî –æ–±—ä—ë–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∞–Ω–æ–º–∞–ª—å–Ω–æ –Ω–∏–∑–∫–∏–º–∏



–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ä–µ–∂–∏–º–µ ‚Üí –æ–Ω–∞ –æ—à–∏–±–∞–µ—Ç—Å—è.



–ï—Å–ª–∏ –∑–Ω–∞–µ—Ç ‚Üí –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è.



---