# Scripts ‚Äî –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–±–æ—Ä–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å–±–æ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## üìä data_collector.py

### –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–≤–µ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (OHLCV) –ø–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º —á–µ—Ä–µ–∑ **API Tinkoff Invest**. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ **Parquet**.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì• **–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** ‚Äî —Å–≤–µ—á–∏ –æ—Ç 5 –º–∏–Ω—É—Ç –¥–æ –Ω–µ–¥–µ–ª–∏
- üìà **–†–∞—Å—á—ë—Ç 30+ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** ‚Äî —Ç—Ä–µ–Ω–¥, –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
- üîÑ **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚ö° **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ä–æ–≤
- üõ°Ô∏è **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- üíæ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî —Å–∂–∞—Ç—ã–π Parquet —Ñ–æ—Ä–º–∞—Ç

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        DataCollector                             ‚îÇ
‚îÇ                    (–≥–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ DataCollector    ‚îÇ  ‚îÇ CandleDataLoader ‚îÇ  ‚îÇ DataFileManager‚îÇ ‚îÇ
‚îÇ  ‚îÇ Config           ‚îÇ  ‚îÇ                  ‚îÇ  ‚îÇ                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ data_dir       ‚îÇ  ‚îÇ ‚Ä¢ load()         ‚îÇ  ‚îÇ ‚Ä¢ load_base()  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ timeframes     ‚îÇ  ‚îÇ ‚Ä¢ retry logic    ‚îÇ  ‚îÇ ‚Ä¢ save_data()  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ max_workers    ‚îÇ  ‚îÇ ‚Ä¢ rate limiting  ‚îÇ  ‚îÇ ‚Ä¢ parquet I/O  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ  ‚îÇ Indicator        ‚îÇ  ‚îÇ DataFrame        ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ Calculator       ‚îÇ  ‚îÇ Cleaner          ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ 6 –≥—Ä—É–ø–ø        ‚îÇ  ‚îÇ ‚Ä¢ –¥—É–±–ª–∏–∫–∞—Ç—ã      ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ 30+ –∏–Ω–¥–∏–∫–∞—Ç.   ‚îÇ  ‚îÇ ‚Ä¢ –≤—ã—Ö–æ–¥–Ω—ã–µ       ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ –≤–∞–ª–∏–¥–∞—Ü–∏—è      ‚îÇ  ‚îÇ ‚Ä¢ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è     ‚îÇ                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

| –ö–ª–∞—Å—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `DataCollector` | –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö |
| `DataCollectorConfig` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ |
| `CandleDataLoader` | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π –∏–∑ API —Å retry-–ª–æ–≥–∏–∫–æ–π |
| `DataFileManager` | –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å Parquet —Ñ–∞–π–ª–æ–≤ |
| `IndicatorCalculator` | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–∞—Å—á—ë—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ |
| `DataFrameCleaner` | –û—á–∏—Å—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö |

---

## üìê –ì—Ä—É–ø–ø—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

–°–∫—Ä–∏–ø—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç **6 –≥—Ä—É–ø–ø —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**:

### 1. TrendIndicators ‚Äî –¢—Ä–µ–Ω–¥–æ–≤—ã–µ

| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä | –°—Ç–æ–ª–±—Ü—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| SMA | `sma5`, `sma10`, `sma20`, `sma50` | –ü—Ä–æ—Å—Ç—ã–µ —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ |
| EMA | `ema10`, `ema20`, `ema50`, `ema200` | –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ |
| MACD | `macd`, `macd_signal`, `macd_hist` | Moving Average Convergence/Divergence |

### 2. OscillatorIndicators ‚Äî –û—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã

| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä | –°—Ç–æ–ª–±–µ—Ü | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| RSI | `rsi` | Relative Strength Index (14 –ø–µ—Ä–∏–æ–¥–æ–≤) |
| Stochastic | `stoch_k`, `stoch_d` | –°—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä |
| CCI | `cci` | Commodity Channel Index |
| Williams %R | `willr` | –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä Williams |

### 3. VolatilityIndicators ‚Äî –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä | –°—Ç–æ–ª–±—Ü—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| ATR | `atr` | Average True Range (14 –ø–µ—Ä–∏–æ–¥–æ–≤) |
| Bollinger Bands | `bb_lower`, `bb_middle`, `bb_upper`, `bb_pband` | –ü–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞ |

### 4. VolumeIndicators ‚Äî –û–±—ä—ë–º

| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä | –°—Ç–æ–ª–±–µ—Ü | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| Vol ROC | `vol_roc` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö |
| Vol SMA | `vol_sma20` | –°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º –∑–∞ 20 –ø–µ—Ä–∏–æ–¥–æ–≤ |
| Rel Volume | `vol_rel` | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—ä—ë–º (—Ç–µ–∫—É—â–∏–π/—Å—Ä–µ–¥–Ω–∏–π) |

### 5. PatternIndicators ‚Äî –°–≤–µ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

| –ü–∞—Ç—Ç–µ—Ä–Ω | –°—Ç–æ–ª–±–µ—Ü | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|----------|
| Doji | `pat_doji` | –ü–∞—Ç—Ç–µ—Ä–Ω –Ω–µ—Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| Hammer | `pat_hammer` | –ú–æ–ª–æ—Ç (—Ä–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω) |
| Engulfing | `pat_engulfing` | –ü–æ–≥–ª–æ—â–µ–Ω–∏–µ |

### 6. RegimeIndicators ‚Äî –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞

| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä | –°—Ç–æ–ª–±–µ—Ü | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| ADX | `adx` | Average Directional Index |
| Volatility Regime | `regime_vol` | 1 = –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å |
| Trend Regime | `regime_trend` | 1 = —Ç—Ä–µ–Ω–¥–æ–≤—ã–π —Ä—ã–Ω–æ–∫ (ADX > 25) |
| Liquidity Regime | `regime_liq` | 1 = –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å |
| Market Regime | `market_regime` | –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (XYZ) |

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–∞–π–º—Ñ—Ä–µ–π–º—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

| –¢–∞–π–º—Ñ—Ä–µ–π–º | –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ì–ª—É–±–∏–Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ |
|-----------|----------|-----------------|
| M5 | 5 –º–∏–Ω—É—Ç | 30 –¥–Ω–µ–π |
| M15 | 15 –º–∏–Ω—É—Ç | 60 –¥–Ω–µ–π |
| M30 | 30 –º–∏–Ω—É—Ç | 120 –¥–Ω–µ–π |
| H1 | 1 —á–∞—Å | 365 –¥–Ω–µ–π |
| H2 | 2 —á–∞—Å–∞ | 730 –¥–Ω–µ–π (2 –≥–æ–¥–∞) |
| H4 | 4 —á–∞—Å–∞ | 730 –¥–Ω–µ–π (2 –≥–æ–¥–∞) |
| D1 | 1 –¥–µ–Ω—å | 3650 –¥–Ω–µ–π (10 –ª–µ—Ç) |
| Week | 1 –Ω–µ–¥–µ–ª—è | 3650 –¥–Ω–µ–π (10 –ª–µ—Ç) |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```python
DataCollectorConfig(
    data_dir=Path("data/tickers"),    # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
    min_history_rows=100,              # –ú–∏–Ω–∏–º—É–º —Å—Ç—Ä–æ–∫ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
    max_workers=2,                     # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
    request_pause_seconds=1.0,         # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    request_jitter_seconds=0.3,        # –°–ª—É—á–∞–π–Ω–∞—è –¥–æ–±–∞–≤–∫–∞ –∫ –ø–∞—É–∑–µ
    max_api_retries=5,                 # –ü–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
    base_retry_delay_seconds=5.0,      # –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ retry
)
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
python scripts/data_collector.py
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∑–∞–ø—É—Å–∫

```python
from scripts.data_collector import DataCollector

# –° –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
collector = DataCollector()
collector.run()
```

### –° –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

```python
from scripts.data_collector import DataCollector, DataCollectorConfig
from pathlib import Path

config = DataCollectorConfig(
    data_dir=Path("my_data/tickers"),
    max_workers=4,
    min_history_rows=50,
    request_pause_seconds=0.5,
)

collector = DataCollector(config)
collector.run()
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```python
from scripts.data_collector import (
    IndicatorCalculator,
    DataFrameCleaner,
    DataFileManager
)
import pandas as pd

# –¢–æ–ª—å–∫–æ —Ä–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
calculator = IndicatorCalculator(min_history_rows=50)
df = pd.read_parquet("data/tickers/SBER/H1.parquet")
df = calculator.calculate(df)

# –¢–æ–ª—å–∫–æ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
cleaner = DataFrameCleaner()
df_clean = cleaner.clean(df)
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```
data/
‚îî‚îÄ‚îÄ tickers/
    ‚îú‚îÄ‚îÄ SBER/
    ‚îÇ   ‚îú‚îÄ‚îÄ M5.parquet
    ‚îÇ   ‚îú‚îÄ‚îÄ M15.parquet
    ‚îÇ   ‚îú‚îÄ‚îÄ M30.parquet
    ‚îÇ   ‚îú‚îÄ‚îÄ H1.parquet
    ‚îÇ   ‚îú‚îÄ‚îÄ H2.parquet
    ‚îÇ   ‚îú‚îÄ‚îÄ H4.parquet
    ‚îÇ   ‚îú‚îÄ‚îÄ D1.parquet
    ‚îÇ   ‚îî‚îÄ‚îÄ Week.parquet
    ‚îú‚îÄ‚îÄ GAZP/
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ .../
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Parquet —Ñ–∞–π–ª–∞

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç DataFrame —Å –∏–Ω–¥–µ–∫—Å–æ–º `time` (datetime) –∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏:

**–ë–∞–∑–æ–≤—ã–µ (OHLCV):**
- `open`, `high`, `low`, `close`, `volume`

**–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- `sma5`, `sma10`, `sma20`, `sma50`
- `ema10`, `ema20`, `ema50`, `ema200` (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö ‚â•200)
- `macd`, `macd_signal`, `macd_hist`
- `rsi`, `stoch_k`, `stoch_d`, `cci`, `willr`
- `atr`, `bb_lower`, `bb_middle`, `bb_upper`, `bb_pband`
- `vol_roc`, `vol_sma20`, `vol_rel`
- `pat_doji`, `pat_hammer`, `pat_engulfing`
- `adx`, `atr_sma50`, `regime_vol`, `regime_trend`, `regime_liq`, `market_regime`

---

## üîß –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
pandas>=2.0.0
pandas-ta>=0.3.14b
numpy>=1.24.0
pyarrow>=12.0.0
tinkoff-investments>=0.2.0
grpcio>=1.50.0
```

---

## üìã –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –°—Ç–∞—Ä—Ç —Å–∫—Ä–∏–ø—Ç–∞  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (parallel) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞             ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ       ‚îÇ
‚îÇ  1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ   ‚îÇ
‚îÇ  2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–∫—É —Å—Ç–∞—Ä—Ç–∞         ‚îÇ
‚îÇ  3. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–µ —Å–≤–µ—á–∏ –∏–∑ API    ‚îÇ
‚îÇ  4. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ + –Ω–æ–≤—ã–µ       ‚îÇ
‚îÇ  5. –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ                 ‚îÇ
‚îÇ  6. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã           ‚îÇ
‚îÇ  7. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Parquet             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     –ì–æ—Ç–æ–≤–æ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Rate Limiting (429)

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ `RESOURCE_EXHAUSTED` —Å–∫—Ä–∏–ø—Ç:
1. –ñ–¥—ë—Ç `base_delay * attempt + random(0, 1)` —Å–µ–∫—É–Ω–¥
2. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å (–¥–æ `max_api_retries` –ø–æ–ø—ã—Ç–æ–∫)
3. –ü—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫ ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º

### –°—Ç–∞—Ç—É—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `SUCCESS` | –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã |
| `NO_NEW_DATA` | API –Ω–µ –≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `NO_NEW_ROWS` | –ü–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ |
| `EMPTY_AFTER_CLEAN` | DataFrame –ø—É—Å—Ç –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ |
| `EMPTY_AFTER_INDICATORS` | DataFrame –ø—É—Å—Ç –ø–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ |
| `ERROR` | –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ |

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª—å `logging` —Å —Ñ–æ—Ä–º–∞—Ç–æ–º:

```
2024-12-11 15:30:45 | INFO     | –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è 25 —Ç–∏–∫–µ—Ä–æ–≤
2024-12-11 15:30:46 | INFO     | SBER | H1 –∑–∞–≥—Ä—É–∑–∫–∞...
2024-12-11 15:30:48 | INFO     | ‚úì SBER | H1: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
2024-12-11 15:30:49 | WARNING  | ‚óã SBER | M5: –Ω–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

## üîç –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ `BaseIndicatorGroup`:

```python
class MyIndicators(BaseIndicatorGroup):
    """–ú–æ–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã."""
    
    def calculate(self, df: pd.DataFrame) -> None:
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã."""
        df["my_indicator"] = df["close"].rolling(10).mean()
```

2. –î–æ–±–∞–≤—å—Ç–µ –≤ `IndicatorCalculator.indicator_groups`:

```python
self.indicator_groups = [
    TrendIndicators(),
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä—É–ø–ø—ã ...
    MyIndicators(),  # –í–∞—à–∞ –Ω–æ–≤–∞—è –≥—Ä—É–ø–ø–∞
]
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

```python
config = DataCollectorConfig(
    timeframes={
        **DataCollectorConfig().timeframes,  # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
        "M1": TimeframeConfig(CandleInterval.CANDLE_INTERVAL_1_MIN, 7),
    }
)
```

